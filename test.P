users(1).
users(2).
users(3).
users(4).
users(5).

roles(ceo).
roles(lead).
roles(ed).
roles(vp).
roles(manager).
roles(cto).

perms(r).
perms(w).
perms(x).
perms(rw).
perms(wx).


ur(1,ceo).
ur(2,lead).
ur(3,ed).
ur(4,vp).
ur(5,manager).

rp(ceo,ceoread).
rp(ceo,ceoexecute).
rp(lead,leadread).
rp(lead,leadexecute).
rp(ed,edread).
rp(ed,edexecute).
rp(vp,vpread).
rp(vp,vpexecute).
rp(manager,managerread).
rp(manager, managerexecute).

rh(ceo,lead).
rh(ceo,ed).
rh(ceo,cto).
/*rh(cto,ceo).*/
rh(ed,vp).
rh(ed,cto).
rh(ed,manager).

member(X, [X|_]).
member(X, [_|Ys]) :-
	member(X,Ys).

not_member(_, []) :- !.

not_member(X, [Head|Tail]) :-
     X \= Head,
    not_member(X, Tail).
	
append([], Y, Y).
append([H|X], Y, [H|Z]) :- append(X, Y, Z).

auth_perm(X,Y) :- 
	auth_role(X,Z),
	auth_perm(Z,Y).

auth_perm(X,Y) :- 
	rp(X,Y).
	
authorized_permissions(X,L) :-
	findall( Y, auth_perm(X, Y), S ),
	sort(S,L).

	
role_heirarchy(X,Y) :-
	rh(X,Y).
		
		
role_heirarchy(X,Y) :-
	rh(X,Z),
	role_heirarchy(Z,Y).
	

auth_role(X,Y) :-
	ur(X,Y).
	
auth_role(X,Y) :-
	ur(X,XR),
	role_heirarchy(XR,Y).

authorized_roles(X,L) :-
	findall( Y, auth_role(X, Y), S ),
	sort(S,L).
	
	
minRoles(S) :-
	findall( Y , ur(X,Y), L ),
	sort(L,L1), len(L1,S).

len(X,Y):-
	findlen(X,Y).
	
findlen([],X) :-
	X is 0.

findlen([X|Tail],Count) :-
	findlen(Tail,Prev),
	Count is Prev+1 .
	
